// trading.js
(function($){
$.fn.candlestickChart=function(customOptions){var $0={day:Date.get_today(),count:20};var $1=$.extend({},$0,customOptions);return this.each(function($p1_0,$p1_1){
var $1_0=Custom.StageMaster.fromElement($p1_1,$1.stage);var $1_1=$($1_0.getContainer());var $1_2=$1_1.data('Custom.CandlestickChart');if(!$1_2){$1_2=new Custom.CandlestickChart($1_0,$1);$1_1.data('Custom.CandlestickChart',$1_2);}});}
Type.registerNamespace('Custom');Custom.StradeStation=function(){}
Custom.StradeStation.prototype={login:function(){}}
Custom.Symbol=function(){}
Custom.Symbol.prototype={id:null,name:null,market:null,value:0,summary:null}
Custom.Candlestick=function(){this.$0=new Kinetic.Rect({strokeWidth:1,stroke:'#0f0'});this.$1=new Kinetic.Line({strokeWidth:1,stroke:'#0f0'});this.$2=new Kinetic.Line({strokeWidth:1,stroke:'#0f0'});this.shape=new Kinetic.Group({});this.shape.add(this.$1);this.shape.add(this.$0);this.shape.add(this.$2);}
Custom.Candlestick.count=function(width){var $0=(width+Custom.Candlestick.marginWidth)/(Custom.Candlestick.blockWidth+Custom.Candlestick.marginWidth);return parseInt($0);}
Custom.Candlestick.prototype={shape:null,$0:null,$1:null,$2:null,setColor:function(color){this.$1.setStroke(color);this.$2.setStroke(color);this.$0.setStroke(color);},setWickWidth:function(value){this.$1.setStrokeWidth(value);this.$2.setStrokeWidth(value);},update:function(startX,zeroY,offset,scaleX,scaleY,day,quote){var $0,$1;var $2;if(quote.open>quote.close){$2=this.$0.getStroke();$0=quote.open;$1=quote.close;}else{$2=null;$0=quote.close;$1=quote.open;}var $3=startX-scaleX*(Custom.Candlestick.blockWidth+Custom.Candlestick.marginWidth)*offset;var $4=scaleX*(Custom.Candlestick.blockWidth-Custom.Candlestick.wickWidth)/2;this.$1.setPoints([{x:$3,y:zeroY-scaleY*quote.max},{x:$3,y:zeroY-scaleY*$0}]);this.$2.setPoints([{x:$3,y:zeroY-scaleY*$1},{x:$3,y:zeroY-scaleY*quote.min}]);this.$0.setPosition($3-$4,zeroY-scaleY*$0);this.$0.setSize(scaleX*Custom.Candlestick.blockWidth,scaleY*($0-$1)+1);this.$0.setFill($2);}}
Custom.CandlestickChart=function(stage,options){Custom.CandlestickChart.initializeBase(this);this.stage=stage;this.quotationFn=Custom.CandlestickChart.generateQuotation;this.$1_7=Date.get_today();this.$1_0={x:0,y:0};this.$1_4={width:0,height:0};this.$1_2={top:5,right:5,bottom:5,left:5};this.$1_6={};this.$1_5={};this.$1_1={x:1,y:1};this.stickColor='#0f0';this.sticks=[];var $0=$(stage.getContainer());this.$1_3={width:$0.width(),height:$0.height()};this.$1_4={};this.$1_C();this.$1_D();this._background=new Kinetic.Layer({});this._highlight=new Kinetic.Rect({strokeWidth:0,fill:'#555',opacity:0.5});this._leftBound=new Kinetic.Line({strokeWidth:1,stroke:'#ccc',opacity:0.5});this._rightBound=new Kinetic.Line({strokeWidth:1,stroke:'#ccc',opacity:0.5});this._zeroBound=new Kinetic.Line({strokeWidth:1,stroke:'#f00',opacity:1});this.$1_B();this._background.add(this._highlight);this._background.add(this._leftBound);this._background.add(this._rightBound);this._background.add(this._zeroBound);this.stage.add(this._background);this._foreground=new Kinetic.Layer({});this.stage.add(this._foreground);this.update(options);this.$1_9={};this.quotationFn(this.$1_9,this.$1_7,this.$1_8);this.refreshForeground();var $1=new Kinetic.Animation(ss.Delegate.create(this,this.$1_A),this._foreground);}
Custom.CandlestickChart.generateQuotation=function(quotation,start,count){for(var $0=0;$0<count;$0++){var $1=5+10*Math.random();var $2=$1+20*Math.random();var $3=$2+50*Math.random();var $4=$3+20*Math.random();var $5;if(Math.random()>0.5){$5={close:$2,max:$4,min:$1,open:$3};}else{$5={close:$3,max:$4,min:$1,open:$2};}quotation[$0]=$5;}}
Custom.CandlestickChart.prototype={stage:null,_background:null,_foreground:null,_highlight:null,_leftBound:null,_rightBound:null,_zeroBound:null,sticks:null,$1_0:null,$1_1:null,$1_2:null,$1_3:null,$1_4:null,$1_5:null,$1_6:null,$1_7:null,$1_8:0,stickColor:null,quotationFn:null,$1_9:null,$1_A:function($p0){if($p0.time%10===1){this._background.draw();}},renderCandleSticks:function(start,quotation){this._foreground.clear();var $0=Math.min(this.$1_8,Object.getKeyCount(quotation));var $1=this.$1_1.x;var $2=this.$1_1.y;for(var $3=0;$3<$0;$3++){var $4;if(this.sticks.length>$3){$4=this.sticks[$3];}else{$4=new Custom.Candlestick();$4.setColor(this.stickColor);this.sticks.add($4);}var $5=new Date();$5.setDate(start.getDay()-$3);$4.update(this.$1_0.x,this.$1_0.y,$3,$1,$2,$5,quotation[$3]);this._foreground.add($4.shape);}},get_range:function(){return {high:this.$1_6.high,low:this.$1_6.low};},set_range:function(value){$.extend(this.$1_6,value);return value;},get_high:function(){return this.$1_6.high;},set_high:function(value){this.$1_6.high=value;return value;},get_low:function(){return this.$1_6.low;},set_low:function(value){this.$1_6.low=value;return value;},get_margin:function(){return {top:this.$1_2.top,right:this.$1_2.right,bottom:this.$1_2.bottom,left:this.$1_2.left};},set_margin:function(value){$.extend(this.$1_2,value);return value;},draw:function(){this._background.draw();this._foreground.draw();},getDate:function(offset){var $0=new Date();$0.setDate(this.$1_7.getDay()-offset);return $0;},max:function(quotation,first,last){if(!Object.getKeyCount(quotation)){return 0;}var $0=quotation[first].max;for(var $1=first+1;$1<=last;$1++){var $2=quotation[$1].max;if($2>$0){$0=$2;}}return $0;},min:function(quotation,first,last){if(!quotation.length){return 0;}var $0=quotation[0].min;for(var $1=first+1;$1<=last;$1++){var $2=quotation[$1].min;if($2<$0){$0=$2;}}return $0;},$1_B:function(){this._rightBound.setPoints([{x:this.$1_0.x,y:this.$1_0.y-this.$1_4.height},{x:this.$1_0.x,y:this.$1_0.y}]);this._leftBound.setPoints([{x:this.$1_0.x-this.$1_4.width,y:this.$1_0.y-this.$1_4.height},{x:this.$1_0.x-this.$1_4.width,y:this.$1_0.y}]);this._zeroBound.setPoints([{x:0,y:this.$1_0.y},{x:this.$1_3.width,y:this.$1_0.y}]);this._highlight.setPosition(this.$1_0.x-this.$1_4.width,this.$1_0.y-this.$1_4.height);this._highlight.setSize(this.$1_4.width,this.$1_4.height-40);},refreshForeground:function(){var $0=Custom.Candlestick.count(this.$1_4.width);if($0>this.$1_8){this.quotationFn(this.$1_9,this.$1_7,$0);}this.$1_8=$0;this.$1_5.high=this.max(this.$1_9,0,this.$1_8-1);this.$1_5.low=this.max(this.$1_9,0,this.$1_8-1);this.$1_1={x:1,y:this.$1_4.height/this.$1_5.high};this.renderCandleSticks(this.$1_7,this.$1_9);},$1_C:function(){this.$1_0.x=Math.round(this.$1_3.width-this.$1_2.right*this.$1_3.width/100);this.$1_4.width=Math.round(this.$1_0.x-this.$1_2.left*this.$1_3.width/100);},$1_D:function(){this.$1_0.y=Math.round(this.$1_3.height-this.$1_2.bottom*this.$1_3.height/100);this.$1_4.height=Math.round(this.$1_0.y-this.$1_2.left*this.$1_3.height/100);},setScale:function(x,y){},setHeight:function(value){this.$1_3.height=value;this.$1_D();this.$1_B();this.refreshForeground();this._background.draw();this._foreground.draw();},setWidth:function(value){this.$1_3.width=value;this.$1_C();this.$1_B();this.refreshForeground();this._background.draw();this._foreground.draw();},update:function(options){}}
Custom.StradeStation.registerClass('Custom.StradeStation');Custom.Symbol.registerClass('Custom.Symbol');Custom.Candlestick.registerClass('Custom.Candlestick');Custom.CandlestickChart.registerClass('Custom.CandlestickChart',Object);Custom.Candlestick.wickWidth=1;Custom.Candlestick.blockWidth=5;Custom.Candlestick.marginWidth=5;})(jQuery);// This script was generated using Script# v0.7.4.0
